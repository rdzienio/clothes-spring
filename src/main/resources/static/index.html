<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Clothes&Weather CRUD app.</title>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css"
          integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
</head>
<body>
<main style="width: 80%; margin: 0 auto">
    <div id="welcome" style="text-align: center">
        <h1>Where are you from</h1>
    </div>
    <form id="cityForm" class="pure-form pure-g pure-form-aligned">
        <input class="pure-input-rounded pure-u-1" name="city" placeholder="city">
        <button id="btn" class="pure-button pure-button-primary pure-u-1">Submit</button>
    </form>
    <table id="clothesTable" class="pure-table-horizontal" style="display: none">
        <tr>
            <td id="table_clothName">Name</td>
            <td id="table_clothCategory">Category</td>
        </tr>
    </table>
    <form id="clothesForm" class="pure-form" style="display: none; text-align: center">
        <ul>
            <input id="clothName" class="pure-input-rounded pure-input-2-3" placeholder="new TODO">
            <button id="addCloth" class="pure-button pure-button-primary">+</button>
        </ul>

    </form>
    <dl id="allClothes"></dl>
</main>
<script>
    (function () {
        const API_URL = 'http://localhost:8080/api';
        const WEATHER_API_URL = `${API_URL}/weather`;
        const CLOTHES_API_URL = `${API_URL}/clothes`;


        function createNewCloth(cloth) {
            const table = document.getElementById('clothesTable')
            const tr = table.insertRow();
            var td_name = tr.insertCell();
            td_name.appendChild(document.createTextNode(cloth.name))

            //document.getElementById('allClothes').appendChild(label);
        }

        function showClothes() {
            fetch(`${CLOTHES_API_URL}`)
                .then(response => response.json())
                .then((clothesArr) => {
                    const clothesList = clothesArr.map(c => `
                <dt>${c.name}</dt>
                <dd>${c.category}</dd>
                `).join('\n');
                    document.getElementById('allClothes').innerHTML = clothesList;
                });
        }

        initCityFormClick();

        function initCityFormClick() {
            const cityForm = document.getElementById('cityForm');

            document.getElementById('btn').addEventListener('click', (event) => {
                event.preventDefault();
                const city = cityForm.elements.city.value;
                fetch(`${WEATHER_API_URL}?city=${city}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
                        weatherForecast="";
                        if (data.rain!=null){
                            weatherForecast = `
                        <h1>Current weather for ${city}</h1>
                        <dl>
                            <dt>Description:</dt>
                            <dd>${data.weather[0].description}</dd>
                            <dt>Temperature:</dt>
                            <dd>${data.main.temp}°C</dd>
                            <dt>Pressure:</dt>
                            <dd>${data.main.pressure}hPa</dd>
                            <dt>Precipitation:</dt>
                            <dd>Rain: ${data.rain["1h"]}mm/h</dd>
                        </dl>
                        `;
                        }
                        else if (data.snow!=null){
                            weatherForecast = `
                        <h1>Current weather for ${city}</h1>
                        <dl>
                            <dt>Description:</dt>
                            <dd>${data.weather[0].description}</dd>
                            <dt>Temperature:</dt>
                            <dd>${data.main.temp}°C</dd>
                            <dt>Pressure:</dt>
                            <dd>${data.main.pressure}hPa</dd>
                            <dt>Precipitation:</dt>
                            <dd>Snow: ${data.snow["1h"]}mm/h</dd>
                        </dl>
                        `;
                        }
                        else
                        {
                            weatherForecast = `
                        <h1>Current weather for ${city}</h1>
                        <dl>
                            <dt>Description:</dt>
                            <dd>${data.weather[0].description}</dd>
                            <dt>Temperature:</dt>
                            <dd>${data.main.temp}°C</dd>
                            <dt>Pressure:</dt>
                            <dd>${data.main.pressure}hPa</dd>
                            <dt>Precipitation:</dt>
                            <dd>Not raining now!</dd>
                        </dl>
                        `;
                        }
                        document.getElementById('welcome').innerHTML = weatherForecast;
                        showClothes();
                        /*cityForm.remove();*/
                        /*<dd>${w['weather'][0]['description']}</dd>*/
                    });
            });
        }

        function processOkResponse(response = {}) {
            if (response.ok) {
                return response.json();
            }
            throw new Error(`Status not 200 (${response.status})`);
        }
    })();
</script>
</body>
</html>
